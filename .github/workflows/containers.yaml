name: Create Docker Image

on:
  push:
    branches: [main]
  pull_request:
  workflow_dispatch:

env:
  REGISTRY: cfaprdbatchcr.azurecr.io
  IMAGE_NAME: pyrenew-hew
  PYRENEW_VERSION: v0.1.1

jobs:

  build-dependencies-image:
    runs-on: cfa-cdcgov
    name: Build dependencies image

    steps:

      - name: Two-step build
        uses: CDCgov/cfa-actions/twostep-container-build@v1.0.1
        with:
          # Login information
          registry: ${{ env.REGISTRY }}
          username: cfaprdbatchcr
          password: ${{ secrets.CFAPRDBATCHCR_REGISTRY_PASSWORD}}
          # Container build information
          container-file-1: ./Containerfile.dependencies
          container-file-2: ./Containerfile
          image: ${{ env.IMAGE_NAME }}
          # Cache information
          first-step-cache-key: docker-dependencies-${{ runner.os }}-${{ hashFiles('./Containerfile.dependencies') }}
