---
title: "Untitled"
format: md
---

```{r}
library(tidyverse)
library(arrow)
library(fs)
library(here)
private_data_dir <- here("pipelines/tests/end_to_end_test_output/private_data")

private_data_dir |>
  dir_ls(recurse = TRUE, type = "file") |>
  path_rel(private_data_dir)

dat <- tibble(
  file_path = dir_ls(private_data_dir, recurse = TRUE, type = "file")
) |>
  mutate(
    name = file_path |> path_split() |> map_chr(11),
    value = map(file_path, read_parquet)
  ) |>
  select(name, value) |>
  deframe()

dat$latest_comprehensive <- dat$`nssp-etl`
dat$`nssp-etl` <- NULL
```

dat$latest_comprehensive

```{r}
head(dat$nssp_etl_gold)

dat$nssp_etl_gold |>
  distinct(geo_type, geo_value, asof, metric, run_id, facility, disease)
```

```{r}
head(dat$nssp_state_level_gold)

dat$nssp_state_level_gold |>
  distinct(geo_type, geo_value, metric, disease, any_update_this_day)
```

```{r}
head(dat$nwss_vintages)

dat$nwss_vintages |>
  distinct(
    lab_id,
    wwtp_id,
    sample_location,
    sample_matrix,
    pcr_target_units,
    pcr_target,
    wwtp_jurisdiction,
    population_served,
    quality_flag,
  )
```

```{r}
head(dat$prod_param_estimates)

dat$prod_param_estimates |>
  distinct(reference_date, disease, format, parameter, geo_value)
```


```{r}
head(dat$latest_comprehensive)

dat$latest_comprehensive |> distinct(geo_type, metric, geo_value, disease)
```
